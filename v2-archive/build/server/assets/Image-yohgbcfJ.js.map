{"version":3,"file":"Image-yohgbcfJ.js","sources":["../../../app/modules/core/components/base/notion/Image.tsx"],"sourcesContent":["import { KeyboardEvent, useEffect, useMemo, useRef, useState } from 'react';\nimport { SlClose } from 'react-icons/sl';\nimport LazyLoad from 'react-lazyload';\nimport type { ReactZoomPanPinchHandlers } from 'react-zoom-pan-pinch';\nimport { TransformComponent, TransformWrapper } from 'react-zoom-pan-pinch';\n\nimport {\n  BlockComponentProps,\n  getFileExtensionFromUrl,\n  ImageBlock,\n  RichTextBlock,\n} from '~/libs/notion';\nimport OptimizedImage from '~/modules/image-optimizer/components/OptimizedImage/OptimizedImage';\n\nimport { RichText } from './RichText';\n\ninterface ImageProps extends BlockComponentProps {\n  basePath?: string;\n  block: ImageBlock;\n}\n\nfunction getAltText(caption: RichTextBlock[]): string {\n  return caption.reduce((finalText, text) => finalText + text.plain_text, '');\n}\n\nexport function Image({ basePath = '/images/posts', block }: ImageProps) {\n  const [isClientReady, setIsClientReady] = useState<boolean>(false);\n  const [zoomEnabled, setZoomEnabled] = useState<boolean>(false);\n  const handlers = useRef<{\n    centerView?: ReactZoomPanPinchHandlers['centerView'];\n    resetTransform?: ReactZoomPanPinchHandlers['resetTransform'];\n  }>({});\n\n  const captionRichTexts = block.image.caption;\n  const extension =\n    'type' in block.image && block.image.type === 'file'\n      ? getFileExtensionFromUrl(block.image.file.url)\n      : '';\n  const url = `${basePath}/${block.id}.${extension}`;\n  const placeholderUrl = `${basePath}/${block.id}-placeholder.png`;\n  const altText = getAltText(captionRichTexts as RichTextBlock[]);\n\n  const caption = captionRichTexts.map((richTextBlock, index) => (\n    <RichText block={richTextBlock as RichTextBlock} key={index} />\n  ));\n\n  const placeholder = (\n    <img alt={altText} className=\"h-64 blur-xl md:h-96\" src={placeholderUrl} />\n  );\n\n  const className = useMemo(\n    () =>\n      zoomEnabled\n        ? 'fixed top-0 left-0 right-0 bottom-0 mt-0'\n        : 'my-2 cursor-zoom-in rounded-md overflow-hidden shadow-lg',\n    [zoomEnabled],\n  );\n\n  const handleWrapperClick = () => {\n    if (!zoomEnabled) {\n      setZoomEnabled(true);\n    }\n  };\n\n  const handleZoomClose = () => {\n    if (handlers.current.resetTransform) handlers.current.resetTransform();\n    setZoomEnabled(false);\n  };\n\n  const handleWrapperKeyUp = (event: KeyboardEvent<HTMLDivElement>) => {\n    if (event.code !== 'Space' && event.code !== 'Escape') return;\n    if (!zoomEnabled) {\n      setZoomEnabled(true);\n    } else {\n      handleZoomClose();\n    }\n  };\n\n  useEffect(() => {\n    setIsClientReady(true);\n  }, []);\n\n  return (\n    <div\n      className={`z-40 flex flex-col items-center justify-center transition ${className}`}\n      onClick={handleWrapperClick}\n      onKeyUp={handleWrapperKeyUp}\n      role=\"button\"\n      tabIndex={0}\n    >\n      {zoomEnabled ? (\n        <>\n          <div\n            className=\"absolute h-full w-full bg-white opacity-95 dark:bg-slate-900\"\n            onClick={handleZoomClose}\n            onKeyUp={handleWrapperKeyUp}\n            role=\"button\"\n            tabIndex={0}\n          />\n        </>\n      ) : null}\n      {isClientReady ? (\n        <LazyLoad placeholder={placeholder}>\n          <TransformWrapper centerOnInit={true} disabled={!zoomEnabled}>\n            {({ resetTransform }) => {\n              handlers.current.resetTransform = resetTransform;\n              return (\n                <TransformComponent>\n                  <OptimizedImage\n                    alt={altText}\n                    className=\"z-50\"\n                    onClick={(event) => event.stopPropagation()}\n                    src={url}\n                  />\n                </TransformComponent>\n              );\n            }}\n          </TransformWrapper>\n        </LazyLoad>\n      ) : (\n        placeholder\n      )}\n      {zoomEnabled ? (\n        <div className=\"mt-4 flex justify-center\">\n          <button\n            className=\"z-50 flex w-28 items-center justify-center text-slate-400 dark:text-slate-500\"\n            onClick={handleZoomClose}\n            type=\"button\"\n          >\n            <SlClose className=\"mr-2\" /> Close\n          </button>\n        </div>\n      ) : null}\n      {!zoomEnabled && caption?.length ? (\n        <span className=\"p-4 text-center text-sm font-light text-slate-400 dark:text-slate-600\">\n          {caption}\n        </span>\n      ) : null}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}