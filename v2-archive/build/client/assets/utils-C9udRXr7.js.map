{"version":3,"file":"utils-C9udRXr7.js","sources":["../../../app/libs/notion/utils.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport type {\n  GetBlockResponse,\n  GetPageResponse,\n} from '@notionhq/client/build/src/api-endpoints';\nimport identity from 'lodash/identity';\n\nimport type { BlockWithChildren, RichTextBlock } from './types';\n\nconst blocksWithText = [\n  'bulleted_list_item',\n  'code',\n  'heading_1',\n  'heading_2',\n  'heading_3',\n  'numbered_list_item',\n  'paragraph',\n  'quote',\n];\n\nexport function hasChildren(block: GetBlockResponse): boolean {\n  return 'has_children' in block && block.has_children;\n}\n\nexport function concatPlainTexts(blocks: RichTextBlock[]): string {\n  return blocks.reduce((finalText, text) => finalText + text.plain_text, '');\n}\n\nexport function generateFullText(blocks: BlockWithChildren[]): string {\n  return blocks.reduce((accumulator, { block, children }) => {\n    if (!('type' in block)) return accumulator;\n\n    let currentBlockText = accumulator;\n\n    if (blocksWithText.includes(block.type)) {\n      currentBlockText = currentBlockText.concat(\n        // @ts-ignore\n        concatPlainTexts(block[block.type].rich_text),\n      );\n    }\n\n    if (children?.length) {\n      currentBlockText = currentBlockText.concat(generateFullText(children));\n    }\n\n    return currentBlockText;\n  }, '');\n}\n\nexport function getExcerpt(blocks: BlockWithChildren[]): string {\n  const inspectedBlocks = blocks.slice(0, 10);\n\n  const excerpt = inspectedBlocks.reduce((accumulator, { block, children }) => {\n    // @ts-ignore\n    const richTextBlocks = block[block.type]?.rich_text || [];\n    let plainTexts = joinStrings(\n      (richTextBlocks as RichTextBlock[]).map(\n        (richText) => richText.plain_text,\n      ),\n    );\n\n    if (children?.length) {\n      plainTexts = joinStrings([plainTexts, getExcerpt(children)]);\n    }\n\n    return plainTexts ? joinStrings([accumulator, plainTexts]) : accumulator;\n  }, '');\n\n  return excerpt.length > 255 ? `${excerpt.slice(0, 255)}...` : excerpt;\n}\n\nfunction formatDateObject(date = {}): string | null {\n  // @ts-ignore\n  return date?.start || null;\n}\n\nfunction formatMultiSelect(items = []): string[] {\n  return items.map(({ name }) => name);\n}\n\nfunction formatSelect(item = {}): string | null {\n  // @ts-ignore\n  return item?.name || null;\n}\n\nconst propertyFormatters = {\n  tags: formatMultiSelect,\n  custom_created_at: formatDateObject,\n  language: formatSelect,\n  category: formatSelect,\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function getProperties(page: GetPageResponse): Record<string, any> {\n  // @ts-ignore\n  const { properties } = page;\n\n  return Object.keys(properties).reduce((accumulator, key) => {\n    const valueProp = properties[key].type;\n\n    if (key === 'title') return accumulator;\n\n    // @ts-ignore\n    const format = propertyFormatters[key] || identity;\n    const value = format(properties[key][valueProp]);\n\n    return {\n      ...accumulator,\n      [key]: value,\n    };\n  }, {});\n}\n\nexport function getTitle(page: GetPageResponse): string | null {\n  if (!('properties' in page)) return null;\n\n  return joinStrings(\n    // @ts-ignore\n    page.properties.title.title.map((title) => title.plain_text),\n  );\n}\n\nexport function getTextFromProperties(\n  properties: Record<string, unknown>,\n  fieldName: string,\n): string | null {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  return (properties?.[fieldName] as any[])?.find(\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (item: any) => item.type === 'text',\n  )?.plain_text;\n}\n\nexport function joinStrings(strings: string[]): string {\n  return strings.filter(Boolean).join(' ').trim();\n}\n\nconst groupTypeMap: Record<string, string> = {\n  numbered_list_item: 'numbered_list',\n  bulleted_list_item: 'bulleted_list',\n};\n\nexport function regroupListItems(\n  blocks: BlockWithChildren[],\n): BlockWithChildren[] {\n  const newBlocks: BlockWithChildren[] = [];\n  let group: BlockWithChildren | null = null;\n\n  blocks.forEach((item, index) => {\n    // process children\n    if (item.children?.length) {\n      item.children = regroupListItems(item.children);\n    }\n\n    // push item to newBlocks if has no type or not a list type\n    if (!('type' in item.block) || !(item.block.type in groupTypeMap)) {\n      if (group) {\n        newBlocks.push(group);\n        group = null;\n      }\n      newBlocks.push(item);\n      return;\n    }\n\n    const { block } = item;\n    const groupType = groupTypeMap[block.type];\n\n    // push item to group if group type matched with the existing group\n    if (\n      group &&\n      group.block &&\n      'type' in group.block &&\n      group.block.type === groupType\n    ) {\n      group.children?.push(item);\n    }\n\n    // push existing group if new item is a different type of list\n    if (\n      group &&\n      group.block &&\n      'type' in group.block &&\n      group.block.type !== groupType\n    ) {\n      newBlocks.push(group);\n    }\n\n    // create new group if no group exists or type is different from the existing group\n    if (!group || ('type' in group.block && group.block.type !== groupType)) {\n      group = {\n        block: {\n          id: `${block.id}-${groupType}`,\n          // @ts-ignore\n          type: groupType,\n        },\n        children: [item],\n      };\n    }\n\n    // push group to newBlocks if it is the last item\n    if (group && index === blocks.length - 1) {\n      newBlocks.push(group);\n    }\n  });\n\n  return newBlocks;\n}\n\nexport function getFileExtensionFromUrl(url: string = '') {\n  if (url?.includes('.gif')) {\n    return 'gif';\n  }\n\n  if (url?.includes('.png')) {\n    return 'png';\n  }\n}\n"],"names":["concatPlainTexts","blocks","finalText","text","getFileExtensionFromUrl","url"],"mappings":"AAwBO,SAASA,EAAiBC,EAAiC,CACzD,OAAAA,EAAO,OAAO,CAACC,EAAWC,IAASD,EAAYC,EAAK,WAAY,EAAE,CAC3E,CAsLgB,SAAAC,EAAwBC,EAAc,GAAI,CACpD,GAAAA,GAAA,MAAAA,EAAK,SAAS,QACT,MAAA,MAGL,GAAAA,GAAA,MAAAA,EAAK,SAAS,QACT,MAAA,KAEX"}