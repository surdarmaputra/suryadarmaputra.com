---
import { generateRandomElementTiltAngle } from "../../utils/ui-utils";

type BadgeVariant =
  | "primary"
  | "secondary"
  | "accent"
  | "neutral"
  | "info"
  | "success"
  | "warning"
  | "error";
type BadgeStyle = "outline" | "dash" | "soft" | "ghost";
type BadgeSize = "xs" | "sm" | "md" | "lg" | "xl";

interface Props {
  variant?: BadgeVariant;
  style?: BadgeStyle;
  size?: BadgeSize;
  colorRandomizer?: number;
  itemIndex?: number;
  class?: string;
}

const {
  variant: variantProp,
  style: styleProp,
  size = "md",
  colorRandomizer,
  itemIndex,
  class: className = "",
} = Astro.props;

// Available variants for color randomization
const variants: BadgeVariant[] = [
  "primary",
  "secondary",
  "accent",
  "neutral",
  "info",
  "success",
  "warning",
  "error",
];

// Determine variant: use colorRandomizer if provided, otherwise use variant prop, default to neutral
let variant: BadgeVariant = "neutral";
if (colorRandomizer !== undefined) {
  variant = variants[colorRandomizer % variants.length];
} else if (variantProp) {
  variant = variantProp;
}

// Use full class names so Tailwind/DaisyUI JIT compiler can detect them
const variantClassMap: Record<BadgeVariant, string> = {
  primary: "badge-primary",
  secondary: "badge-secondary",
  accent: "badge-accent",
  neutral: "badge-neutral",
  info: "badge-info",
  success: "badge-success",
  warning: "badge-warning",
  error: "badge-error",
};

const styleClassMap: Record<BadgeStyle, string> = {
  outline: "badge-outline",
  dash: "badge-dash",
  soft: "badge-soft",
  ghost: "badge-ghost",
};

const sizeClassMap: Record<BadgeSize, string> = {
  xs: "badge-xs",
  sm: "badge-sm",
  md: "",
  lg: "badge-lg",
  xl: "badge-xl",
};

const variantClass = variantClassMap[variant];
const styleClass = styleProp ? styleClassMap[styleProp] : "";
const sizeClass = sizeClassMap[size];

// Always generate random tilt using itemIndex if provided, otherwise default to 0
const tilt = generateRandomElementTiltAngle(itemIndex ?? 0);

// Build class string
const classParts = [
  "badge",
  variantClass,
  styleClass,
  sizeClass,
  "badge-tilt",
  "transition-transform",
  "duration-300",
  "hover:rotate-6",
  "active:rotate-6",
  className,
].filter(Boolean);
const classes = classParts.join(" ");
---

<span class={classes} style={`--badge-tilt: ${tilt}deg;`}>
  <slot />
</span>

