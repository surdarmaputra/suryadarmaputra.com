---
import { getBlockRichText } from "../renderer-utils";
import type { BlockWithChildren } from "../types";
import RichText from "./rich-text.astro";

interface Props {
  block: BlockWithChildren["block"];
  children?: BlockWithChildren[];
  previousBlockType?: string | null;
  imageBasePath: string;
  imageIdPrefix?: string;
  renderChildren?: typeof import("../blocks-renderer.astro").default;
}

const { block, children, previousBlockType, imageBasePath, imageIdPrefix, renderChildren } =
  Astro.props;

// Assign to capitalized variable for Astro to recognize as component
const RenderChildren = renderChildren;

if (!("type" in block) || block.type !== "paragraph") {
  return null;
}

const richTexts = getBlockRichText(block);
const headingBlockTypes = ["heading_1", "heading_2", "heading_3"];

// Add spacing after headings, otherwise normal paragraph spacing
const spacingClass =
  previousBlockType && headingBlockTypes.includes(previousBlockType) ? "mt-4" : "my-6";
---

{richTexts.length > 0 && (
  <p class={`text-base md:text-lg leading-relaxed text-base-content ${spacingClass}`}>
    {richTexts.map((richTextBlock) => (
      <RichText block={richTextBlock} />
    ))}
    {children && children.length > 0 && RenderChildren && (
      <RenderChildren blocks={children} imageBasePath={imageBasePath} imageIdPrefix={imageIdPrefix} />
    )}
  </p>
)}

