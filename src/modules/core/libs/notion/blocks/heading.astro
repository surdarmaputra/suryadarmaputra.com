---
import { getBlockRichText } from "../renderer-utils";
import type { BlockWithChildren } from "../types";
import RichText from "./rich-text.astro";

interface Props {
  block: BlockWithChildren["block"];
  children?: BlockWithChildren[];
  imageBasePath: string;
  renderChildren?: typeof import("../blocks-renderer.astro").default;
}

const { block, children, imageBasePath, renderChildren } = Astro.props;

// Assign to capitalized variable for Astro to recognize as component
const RenderChildren = renderChildren;

if (!("type" in block)) {
  return null;
}

const isHeading =
  block.type === "heading_1" || block.type === "heading_2" || block.type === "heading_3";
if (!isHeading) {
  return null;
}

const level = block.type.replace("heading_", "");
const headingTag = `h${level}`;
const richTexts = getBlockRichText(block);
---

{richTexts.length > 0 && (
  <>
    {headingTag === "h1" && (
      <h1 class="text-4xl md:text-5xl font-bold text-base-content mt-12 mb-6 leading-tight">
        {richTexts.map((richTextBlock) => (
          <RichText block={richTextBlock} />
        ))}
        {children && children.length > 0 && RenderChildren && (
          <RenderChildren blocks={children} imageBasePath={imageBasePath} />
        )}
      </h1>
    )}
    {headingTag === "h2" && (
      <h2 class="text-3xl md:text-4xl font-bold text-base-content mt-10 mb-5 leading-tight">
        {richTexts.map((richTextBlock) => (
          <RichText block={richTextBlock} />
        ))}
        {children && children.length > 0 && RenderChildren && (
          <RenderChildren blocks={children} imageBasePath={imageBasePath} />
        )}
      </h2>
    )}
    {headingTag === "h3" && (
      <h3 class="text-2xl md:text-3xl font-semibold text-base-content mt-8 mb-4 leading-snug">
        {richTexts.map((richTextBlock) => (
          <RichText block={richTextBlock} />
        ))}
        {children && children.length > 0 && RenderChildren && (
          <RenderChildren blocks={children} imageBasePath={imageBasePath} />
        )}
      </h3>
    )}
  </>
)}

