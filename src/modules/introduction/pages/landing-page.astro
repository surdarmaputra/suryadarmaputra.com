---
import ArticleListSection from "../../article/components/article-list-section.astro";
import type { Article } from "../../article/types";
import Footer from "../../core/components/layouts/footer.astro";
import PageLayout from "../../core/components/layouts/page-layout.astro";
import ProjectCarouselSection from "../../project/components/project-carousel-section.astro";
import { getProjectsByCompany } from "../../project/services/project-service";
import ExperienceJourneySection from "../components/experience-journey-section.astro";
import HeroSection from "../components/hero-section.astro";
import SocialLinksSection from "../components/social-links-section.astro";
import WorkExperienceSection from "../components/work-experience-section.astro";

// Fetch personal projects and randomize for landing page
const personalProjects = await getProjectsByCompany();
const shuffledProjects = [...personalProjects].sort(() => Math.random() - 0.5);
const projects = shuffledProjects.slice(0, 6);

const articles: Article[] = [
  {
    id: "1",
    title: "Getting Started with Astro",
    description: "Learn how to build fast, modern websites with Astro framework.",
    date: "2024-01-15",
    slug: "getting-started-with-astro",
    minsRead: 5,
  },
  {
    id: "2",
    title: "Understanding Module-Based Architecture",
    description: "A deep dive into organizing code with modular architecture patterns.",
    date: "2024-01-10",
    slug: "module-based-architecture",
    minsRead: 8,
  },
  {
    id: "3",
    title: "Building with DaisyUI",
    description: "Creating beautiful UIs with DaisyUI and Tailwind CSS.",
    date: "2024-01-05",
    slug: "building-with-daisyui",
    minsRead: 6,
  },
];

const currentPath = Astro.url.pathname;
---

<PageLayout title="Home" description="Personal website and blog" currentPath={currentPath}>
  <HeroSection />
  
  <ExperienceJourneySection />
  
  <ProjectCarouselSection projects={projects} />
  
  <WorkExperienceSection />
  
  <ArticleListSection articles={articles} />
  
  <SocialLinksSection />
  
  <Footer />
</PageLayout>

<script>
  import { initArticleListItemScrollReveal } from "../../article/utils/ui-utils";
  import { initAfterNavigation } from "../../core/utils/ui-utils";
  
  // Smooth scroll for anchor links
  function initSmoothScroll() {
    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
      anchor.addEventListener('click', (e) => {
        const href = anchor.getAttribute('href');
        if (href && href !== '#') {
          const target = document.querySelector(href);
          if (target) {
            e.preventDefault();
            const headerOffset = 80;
            const elementPosition = target.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
            
            window.scrollTo({
              top: offsetPosition,
              behavior: 'smooth',
            });
          }
        }
      });
    });
  }
  
  initAfterNavigation(() => {
    initArticleListItemScrollReveal();
    initSmoothScroll();
  });
</script>
