---
import Breadcrumb from "../../core/components/base/breadcrumb.astro";
import Ornament from "../../core/components/base/ornament.astro";
import Footer from "../../core/components/layouts/footer.astro";
import PageLayout from "../../core/components/layouts/page-layout.astro";
import { generateRandomElementTiltAngle } from "../../core/utils/ui-utils";

interface ContentItem {
  type: "paragraph" | "image" | "bullet-list";
  paragraph?: string;
  image?: string;
  alt?: string;
  bullets?: string[];
}

interface ArticleNav {
  title: string;
  slug: string;
}

interface Props {
  title: string;
  date: string;
  minsRead?: number;
  content: ContentItem[];
  categories: string[];
  previousArticle?: ArticleNav;
  nextArticle?: ArticleNav;
}

const { title, date, minsRead, content, categories, previousArticle, nextArticle } = Astro.props;
const currentPath = Astro.url.pathname;

const breadcrumbItems = [
  { label: "Home", href: "/" },
  { label: "Articles", href: "/articles" },
  { label: title },
];

// Format date
const articleDate = new Date(date);
const formattedDate = articleDate.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

// Generate tilt angles for categories
const categoryConfigs = categories.map((category, index) => {
  const tilt = generateRandomElementTiltAngle(index, 3);
  const colors = [
    "badge-primary",
    "badge-secondary",
    "badge-accent",
    "badge-neutral",
    "badge-info",
    "badge-success",
  ];
  const color = colors[index % colors.length];
  return { category, tilt, color };
});
---

<PageLayout title={title} description={`${title} article`} currentPath={currentPath}>
  <div class="relative min-h-screen">
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <Ornament variant="circle" size="md" color="accent" position="top-left" />
      <Ornament variant="dots" size="md" color="primary" position="top-right" />
      <Ornament variant="square" size="lg" color="secondary" position="center" />
    </div>

    <div class="container max-w-4xl mx-auto px-4 py-12 md:py-28 relative z-10">
      <!-- Breadcrumb -->
      <div class="mb-1">
        <Breadcrumb items={breadcrumbItems} />
      </div>

      <!-- Page Title -->
      <h1 class="text-4xl md:text-5xl font-bold font-serif text-left text-base-content animate-fade-in-up mb-6">
        {title}
      </h1>

      <!-- Date and Reading Time -->
      <div class="flex items-center gap-4 text-base-content/60 text-sm md:text-base mb-12 md:mb-16">
        <time datetime={date}>{formattedDate}</time>
        <span>•</span>
        <span>{minsRead || 5} min read</span>
      </div>

      <!-- Content Sections -->
      <div class="space-y-12 mb-16">
        {content.map((item, index) => {
          const delay = index * 100;
          let delayClass = "animation-delay-0";
          if (delay === 100) delayClass = "animation-delay-150";
          else if (delay === 200) delayClass = "animation-delay-300";
          else if (delay === 300) delayClass = "animation-delay-450";
          else if (delay === 400) delayClass = "animation-delay-600";
          else if (delay >= 500) delayClass = "animation-delay-750";

          return (
            <div class={`animate-fade-in-up ${delayClass}`}>
              {item.type === "paragraph" && item.paragraph && (
                <p class="text-base-content leading-relaxed">{item.paragraph}</p>
              )}

              {item.type === "image" && item.image && (
                <figure class="mb-6 border-4 border-neutral rounded-lg shadow-lg overflow-hidden">
                  <img
                    src={item.image}
                    alt={item.alt || `${title} - Image ${index + 1}`}
                    class="w-full"
                  />
                </figure>
              )}

              {item.type === "bullet-list" && item.bullets && (
                <ul class="list-disc list-outside space-y-2 ml-5">
                  {item.bullets.map((bullet) => (
                    <li class="text-base-content leading-relaxed">{bullet}</li>
                  ))}
                </ul>
              )}
            </div>
          );
        })}
      </div>

      <!-- Categories Section -->
      {categories.length > 0 && (
        <div class="max-w-4xl mx-auto my-16">
          <div class="flex flex-wrap gap-4">
            {categoryConfigs.map((config) => (
              <span
                class={`badge badge-lg ${config.color} badge-tilt transition-transform duration-300 hover:rotate-1`}
                style={`--badge-tilt: ${config.tilt}deg;`}
              >
                {config.category}
              </span>
            ))}
          </div>
        </div>
      )}

      <!-- Previous/Next Navigation -->
      {(previousArticle || nextArticle) && (
        <div class="max-w-4xl mx-auto mt-16 flex flex-col md:flex-row justify-between gap-4">
          {previousArticle ? (
            <a
              href={`/articles/${previousArticle.slug}`}
              class="link link-hover text-left flex-1 group"
            >
              <div class="text-sm text-base-content/60 mb-1">← Previous</div>
              <div class="truncate text-base-content group-hover:text-primary">
                {previousArticle.title}
              </div>
            </a>
          ) : (
            <div class="flex-1"></div>
          )}

          {nextArticle ? (
            <a
              href={`/articles/${nextArticle.slug}`}
              class="link link-hover text-right flex-1 group"
            >
              <div class="text-sm text-base-content/60 mb-1">Next →</div>
              <div class="truncate text-base-content group-hover:text-primary">
                {nextArticle.title}
              </div>
            </a>
          ) : (
            <div class="flex-1"></div>
          )}
        </div>
      )}
    </div>
  </div>

  <Footer />
</PageLayout>

